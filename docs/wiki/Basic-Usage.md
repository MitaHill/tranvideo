# 基础使用指南

本文档介绍 Tranvideo 的基本使用方法，包括 Web 界面操作和常见使用场景。

## 目录

- [Web 界面使用](#web-界面使用)
- [处理模式说明](#处理模式说明)
- [常见使用场景](#常见使用场景)
- [文件管理](#文件管理)
- [最佳实践](#最佳实践)

---

## Web 界面使用

### 访问界面

部署完成后，在浏览器中访问：

```
http://localhost:5000          # 本地访问
http://your-server-ip:5000     # 远程访问
```

### 界面布局

```
┌─────────────────────────────────────────────┐
│  Tranvideo - 视频翻译平台                   │
├─────────────────────────────────────────────┤
│                                             │
│  [邀请码输入框]                             │
│  ┌───────────────────────────┐             │
│  │ kindmita                  │ [验证]     │
│  └───────────────────────────┘             │
│                                             │
│  [文件上传区域]                             │
│  ┌───────────────────────────┐             │
│  │  拖拽文件到这里           │             │
│  │  或点击选择文件           │             │
│  └───────────────────────────┘             │
│                                             │
│  处理模式:                                  │
│  ( ) 仅生成字幕                             │
│  (•) 生成带字幕的视频                       │
│                                             │
│  [开始处理] [取消]                          │
│                                             │
│  进度:                                      │
│  ████████████░░░░░░░░ 60%                   │
│  翻译原文字幕 (120/200)                     │
│                                             │
└─────────────────────────────────────────────┘
```

### 第一步：输入邀请码

1. 在邀请码输入框中输入您的邀请码
2. 默认公开邀请码：`kindmita`
3. 点击"验证"按钮

**邀请码说明**：
- 每个邀请码有时长配额限制
- 配额按视频时长计算
- 配额不足时需要联系管理员

### 第二步：上传视频文件

#### 方式一：拖拽上传

1. 将视频文件拖拽到上传区域
2. 系统会自动检测文件格式和时长
3. 显示预估处理时间

#### 方式二：点击选择

1. 点击上传区域
2. 在文件选择器中选择视频文件
3. 确认选择

#### 支持的视频格式

| 格式 | 扩展名 | 说明 |
|------|--------|------|
| MP4 | .mp4 | 推荐，兼容性最好 |
| AVI | .avi | 支持 |
| MOV | .mov | Apple 格式，支持 |
| MKV | .mkv | 支持 |
| FLV | .flv | 支持 |
| WMV | .wmv | Windows 格式，支持 |
| WEBM | .webm | Web 格式，支持 |

#### 文件限制

- **最大文件大小**：2GB
- **最小时长**：无限制
- **最大时长**：取决于邀请码配额

### 第三步：选择处理模式

#### 模式一：仅生成字幕

- **输出**：3 个 SRT 字幕文件
  - `xxx_raw.srt` - 原始语言字幕
  - `xxx_translated.srt` - 翻译后字幕
  - `xxx_bilingual.srt` - 双语字幕
- **处理时间**：相对较快
- **适用场景**：已有视频，只需要字幕文件

#### 模式二：生成带字幕的视频

- **输出**：3 个 SRT 文件 + 1 个视频文件
  - `xxx_raw.srt`
  - `xxx_translated.srt`
  - `xxx_bilingual.srt`
  - `xxx_final.mp4` - 嵌入字幕的视频
- **处理时间**：较长（需要视频合成）
- **适用场景**：需要分享带字幕的视频

### 第四步：开始处理

1. 确认选择的处理模式
2. 点击"开始处理"按钮
3. 系统创建任务并加入队列

### 第五步：监控进度

#### 进度条说明

```
████████████░░░░░░░░ 60%
```

- **绿色**：已完成部分
- **灰色**：待处理部分
- **百分比**：整体进度

#### 状态说明

| 状态 | 说明 | 进度范围 |
|------|------|---------|
| 队列中 | 等待其他任务完成 | 0% |
| processing | 初始化处理 | 0-10% |
| 提取原文字幕 | Whisper 语音识别 | 10-50% |
| 翻译原文字幕 | AI 翻译 | 50-90% |
| 合成视频 | FFmpeg 嵌入字幕 | 90-100% |
| 已完成 | 处理完成 | 100% |

#### 详细进度信息

```
状态: 翻译原文字幕
进度: 翻译中... (120/200)
预计剩余时间: 约 5 分钟
```

- **当前状态**：显示当前处理阶段
- **进度详情**：显示具体进度（如：120/200 表示已翻译 120 句，共 200 句）
- **预计时间**：根据当前速度估算的剩余时间

### 第六步：下载结果

处理完成后，界面会显示下载按钮：

```
✅ 处理完成！

下载:
[原始字幕] [翻译字幕] [双语字幕] [带字幕视频]
```

点击对应按钮下载文件。

---

## 处理模式说明

### SRT 字幕格式

SRT（SubRip Subtitle）是最常用的字幕格式：

```srt
1
00:00:00,000 --> 00:00:05,000
Hello, welcome to Tranvideo!

2
00:00:05,500 --> 00:00:10,000
This is a demonstration video.
```

**格式说明**：
- 第一行：序号
- 第二行：时间码（开始 --> 结束）
- 第三行：字幕文本
- 空行分隔

### 三种字幕类型

#### 1. 原始字幕（raw.srt）

```srt
1
00:00:00,000 --> 00:00:05,000
Hello, welcome to Tranvideo!
```

- 语音识别的原始结果
- 保留原语言
- 适合：学习外语、核对翻译

#### 2. 翻译字幕（translated.srt）

```srt
1
00:00:00,000 --> 00:00:05,000
你好，欢迎来到 Tranvideo！
```

- 翻译后的文本
- 目标语言（默认中文）
- 适合：观看理解、字幕添加

#### 3. 双语字幕（bilingual.srt）

```srt
1
00:00:00,000 --> 00:00:05,000
Hello, welcome to Tranvideo!
你好，欢迎来到 Tranvideo！
```

- 原文 + 译文
- 上下两行显示
- 适合：语言学习、对照阅读

### 视频模式输出

带字幕的视频文件特点：

- **格式**：MP4（H.264 编码）
- **字幕轨道**：3 条字幕轨道
  - Track 1: 原始语言
  - Track 2: 翻译语言
  - Track 3: 双语
- **默认字幕**：翻译语言
- **切换方式**：播放器中切换字幕轨道

---

## 常见使用场景

### 场景一：学习外语视频

**需求**：观看英文教学视频，需要中英双语字幕

**操作步骤**：

1. 上传英文视频
2. 选择"仅生成字幕"模式
3. 等待处理完成
4. 下载"双语字幕"文件
5. 使用播放器加载原视频和字幕

**推荐播放器**：
- VLC Media Player
- PotPlayer
- MPC-HC

### 场景二：制作翻译视频

**需求**：将外语视频翻译并分享给他人

**操作步骤**：

1. 上传视频文件
2. 选择"生成带字幕的视频"模式
3. 等待处理完成
4. 下载带字幕的视频文件
5. 直接分享视频

**优势**：
- 无需手动添加字幕
- 字幕已嵌入视频
- 任何播放器都能显示

### 场景三：提取会议录音

**需求**：将会议录音转换为文字记录

**操作步骤**：

1. 将录音转换为视频格式（或直接上传视频）
2. 选择"仅生成字幕"模式
3. 下载原始字幕文件
4. 提取 SRT 文件中的文本内容

**提取文本工具**：

```python
# 从 SRT 提取文本
def extract_text_from_srt(srt_file):
    with open(srt_file, 'r', encoding='utf-8') as f:
        lines = f.readlines()

    text = []
    for line in lines:
        line = line.strip()
        # 跳过序号和时间码
        if line and not line.isdigit() and '-->' not in line:
            text.append(line)

    return '\n'.join(text)

# 使用
text = extract_text_from_srt('example_raw.srt')
with open('transcript.txt', 'w', encoding='utf-8') as f:
    f.write(text)
```

### 场景四：批量处理课程视频

**需求**：处理多个系列课程视频

**操作步骤**：

1. 准备多个视频文件
2. 使用批量上传功能
3. 选择处理模式
4. 等待批量处理完成
5. 下载批量结果（ZIP 包）

详见：[批量处理文档](Batch-Processing.md)

---

## 文件管理

### 文件存储位置

#### Docker 部署

```
cache/
├── uploads/              # 上传的视频文件
│   └── 20251023_103045_abc123.mp4
├── temp/                 # 临时处理文件
│   └── 20251023_103045_abc123/
│       ├── audio.wav
│       ├── raw.srt
│       └── translated.srt
└── outputs/              # 最终输出文件
    ├── 20251023_103045_abc123_raw.srt
    ├── 20251023_103045_abc123_translated.srt
    ├── 20251023_103045_abc123_bilingual.srt
    └── 20251023_103045_abc123_final.mp4
```

#### 源码部署

文件存储在项目根目录的 `cache/` 目录下。

### 文件保留时间

- **上传文件**：24 小时
- **输出文件**：24 小时（下载后）
- **临时文件**：处理完成后立即删除

### 手动清理缓存

```bash
# Docker 部署
docker compose exec tranvideo rm -rf /root/tranvideo/cache/*

# 源码部署
rm -rf cache/*
```

### 下载文件建议

1. **立即下载**：处理完成后尽快下载
2. **本地备份**：保存到本地磁盘
3. **云端同步**：上传到云盘备份

---

## 最佳实践

### 1. 视频准备

#### 音频质量

- **清晰度**：确保音频清晰，无严重噪音
- **音量**：适中，不要过小或过大
- **语速**：正常语速识别效果最好

#### 视频格式

- **推荐格式**：MP4（H.264 + AAC）
- **分辨率**：不影响处理，但影响最终文件大小
- **帧率**：不影响字幕处理

#### 文件压缩

如果视频文件过大（>2GB），可以压缩：

```bash
# 使用 FFmpeg 压缩视频
ffmpeg -i input.mp4 \
  -c:v libx264 -crf 23 \
  -c:a aac -b:a 128k \
  output.mp4
```

### 2. 邀请码管理

#### 查看配额

访问 API 查看剩余配额：

```bash
curl http://localhost:5000/api/invitation/check/kindmita
```

响应：

```json
{
  "valid": true,
  "remaining_time": 7200,
  "quota": {
    "used": 3600,
    "total": 10800,
    "remaining": 7200
  }
}
```

#### 配额计算

- **计费方式**：按视频时长
- **30分钟视频** = 30 分钟配额
- **提示**：合理规划任务，避免浪费

### 3. 处理时间估算

| 视频时长 | 估算处理时间 | GPU | 说明 |
|---------|-------------|-----|------|
| 5 分钟 | 2-3 分钟 | RTX 4070 Ti | 约 2:1 |
| 10 分钟 | 5-6 分钟 | RTX 4070 Ti | |
| 30 分钟 | 15-20 分钟 | RTX 4070 Ti | |
| 60 分钟 | 30-40 分钟 | RTX 4070 Ti | |

**影响因素**：
- GPU 性能
- 视频语音密度
- 翻译模型速度
- 服务器负载

### 4. 错误处理

#### 上传失败

- **检查文件格式**：确保是支持的视频格式
- **检查文件大小**：不超过 2GB
- **检查网络连接**：确保网络稳定

#### 处理失败

- **查看错误信息**：界面会显示具体错误
- **重新上传**：有时重试可以解决问题
- **检查配置**：确认 Ollama 服务正常

#### 下载失败

- **刷新页面**：重新获取下载链接
- **检查文件是否过期**：24 小时后自动删除
- **联系管理员**：如果持续失败

### 5. 性能优化

#### 选择合适的模式

- **只需字幕**：选择"仅生成字幕"
- **需要分享**：选择"生成带字幕的视频"

#### 避免重复处理

- **保存任务 ID**：记录任务 ID 以便查询
- **定期下载**：及时下载避免过期

#### 合理使用批量功能

- **相似视频**：一起批量处理
- **不超过 10 个**：单次批量限制

---

## 快捷操作

### 键盘快捷键

| 快捷键 | 功能 |
|--------|------|
| Ctrl+V | 粘贴文件（拖拽区域焦点） |
| Ctrl+U | 打开文件选择器 |
| Enter | 开始处理（文件已选择） |
| Esc | 取消上传 |

### 浏览器书签

添加常用链接到书签：

```
http://localhost:5000           # 主页
http://localhost:5000/api-docs.html  # API 文档
http://localhost:5000/faq.html       # 常见问题
```

---

## 进阶技巧

### 自定义翻译提示词

修改 `config/prompt.txt` 自定义翻译风格：

```
你是专业翻译。将外语翻译成自然流畅的中文，
保持原意可适当润色修饰。只输出代码块格式：``````，
将译文内容放入代码块中，不要有其它提示性内容。
```

### 使用 API 自动化

参见 [API 参考文档](API-Reference.md) 实现自动化处理。

### 集成到工作流

```python
# 监控目录自动处理
import os
import time
from watchdog.observers import Observer
from watchdog.events import FileSystemEventHandler

class VideoHandler(FileSystemEventHandler):
    def on_created(self, event):
        if event.src_path.endswith('.mp4'):
            # 自动上传处理
            client.upload_video(event.src_path)

observer = Observer()
observer.schedule(VideoHandler(), path='/videos', recursive=False)
observer.start()
```

---

## 常见问题

### Q: 支持哪些语言？

A: Whisper 支持 99+ 种语言的识别，翻译默认翻译成中文，可以通过修改提示词更改目标语言。

### Q: 字幕不准确怎么办？

A:
1. 检查音频质量
2. 尝试更大的 Whisper 模型
3. 手动修正 SRT 文件

### Q: 可以只翻译不识别吗？

A: 不支持，必须先语音识别再翻译。如果已有字幕，可以直接使用翻译 API。

### Q: 支持实时处理吗？

A: 目前不支持实时处理，只支持上传后离线处理。

---

## 下一步

- 📦 [批量处理](Batch-Processing.md) - 批量处理多个视频
- ⚙️ [配置指南](Configuration.md) - 自定义配置
- 🔧 [API 文档](API-Reference.md) - API 集成开发
- 💡 [故障排除](Troubleshooting.md) - 问题解决

---

**文档版本**: v1.0
**最后更新**: 2025-10-24
**维护者**: MitaHill

[返回 Wiki 首页](Home.md)
