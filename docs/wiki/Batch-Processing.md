# æ‰¹é‡å¤„ç†æŒ‡å—

æœ¬æ–‡æ¡£ä»‹ç»å¦‚ä½•ä½¿ç”¨ Tranvideo çš„æ‰¹é‡å¤„ç†åŠŸèƒ½ï¼Œä¸€æ¬¡æ€§å¤„ç†å¤šä¸ªè§†é¢‘æ–‡ä»¶ã€‚

## ç›®å½•

- [æ‰¹é‡å¤„ç†æ¦‚è¿°](#æ‰¹é‡å¤„ç†æ¦‚è¿°)
- [Web ç•Œé¢æ‰¹é‡å¤„ç†](#web-ç•Œé¢æ‰¹é‡å¤„ç†)
- [API æ‰¹é‡å¤„ç†](#api-æ‰¹é‡å¤„ç†)
- [æ‰¹é‡ä»»åŠ¡ç®¡ç†](#æ‰¹é‡ä»»åŠ¡ç®¡ç†)
- [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)
- [æ•…éšœæ’é™¤](#æ•…éšœæ’é™¤)

---

## æ‰¹é‡å¤„ç†æ¦‚è¿°

### ä»€ä¹ˆæ˜¯æ‰¹é‡å¤„ç†

æ‰¹é‡å¤„ç†å…è®¸ä¸€æ¬¡ä¸Šä¼ å¤šä¸ªè§†é¢‘æ–‡ä»¶ï¼Œç³»ç»Ÿä¼šï¼š

1. åˆ›å»ºä¸€ä¸ªæ‰¹æ¬¡ï¼ˆBatchï¼‰
2. ä¸ºæ¯ä¸ªè§†é¢‘åˆ›å»ºä¸€ä¸ªå­ä»»åŠ¡
3. æŒ‰é¡ºåºä¾æ¬¡å¤„ç†æ‰€æœ‰è§†é¢‘
4. æä¾›æ‰¹é‡ä¸‹è½½åŠŸèƒ½

### æ‰¹é‡å¤„ç†çš„ä¼˜åŠ¿

- **èŠ‚çœæ—¶é—´**ï¼šä¸€æ¬¡ä¸Šä¼ ï¼Œæ— éœ€é‡å¤æ“ä½œ
- **ç»Ÿä¸€ç®¡ç†**ï¼šæ‰€æœ‰ä»»åŠ¡é›†ä¸­ç®¡ç†
- **æ‰¹é‡ä¸‹è½½**ï¼šä¸€ä¸ª ZIP åŒ…ä¸‹è½½æ‰€æœ‰ç»“æœ
- **é˜Ÿåˆ—ç®¡ç†**ï¼šè‡ªåŠ¨æ’é˜Ÿå¤„ç†

### é™åˆ¶è¯´æ˜

| é™åˆ¶é¡¹ | å€¼ | è¯´æ˜ |
|--------|-----|------|
| å•æ¬¡æœ€å¤§æ–‡ä»¶æ•° | 10 ä¸ª | ä¸€æ¬¡æ‰¹é‡æœ€å¤š 10 ä¸ªæ–‡ä»¶ |
| å•æ–‡ä»¶æœ€å¤§å¤§å° | 2GB | æ¯ä¸ªæ–‡ä»¶ä¸è¶…è¿‡ 2GB |
| æ€»é…é¢é™åˆ¶ | ä¾é‚€è¯·ç  | æ€»æ—¶é•¿ä¸è¶…è¿‡é…é¢ |
| å¹¶å‘å¤„ç† | 1 ä¸ª | åŒæ—¶åªå¤„ç†ä¸€ä¸ªä»»åŠ¡ |

---

## Web ç•Œé¢æ‰¹é‡å¤„ç†

### æ­¥éª¤ä¸€ï¼šé€‰æ‹©å¤šä¸ªæ–‡ä»¶

#### æ–¹å¼ä¸€ï¼šCtrl/Cmd + ç‚¹å‡»

1. ç‚¹å‡»ä¸Šä¼ åŒºåŸŸ
2. åœ¨æ–‡ä»¶é€‰æ‹©å™¨ä¸­æŒ‰ä½ Ctrlï¼ˆWindowsï¼‰æˆ– Cmdï¼ˆMacï¼‰
3. ç‚¹å‡»é€‰æ‹©å¤šä¸ªæ–‡ä»¶
4. ç‚¹å‡»"æ‰“å¼€"

#### æ–¹å¼äºŒï¼šæ‹–æ‹½å¤šä¸ªæ–‡ä»¶

1. åœ¨æ–‡ä»¶ç®¡ç†å™¨ä¸­é€‰æ‹©å¤šä¸ªè§†é¢‘æ–‡ä»¶
2. æ‹–æ‹½åˆ°ä¸Šä¼ åŒºåŸŸ
3. æ¾å¼€é¼ æ ‡

#### æ–¹å¼ä¸‰ï¼šShift + ç‚¹å‡»ï¼ˆè¿ç»­é€‰æ‹©ï¼‰

1. ç‚¹å‡»ç¬¬ä¸€ä¸ªæ–‡ä»¶
2. æŒ‰ä½ Shift
3. ç‚¹å‡»æœ€åä¸€ä¸ªæ–‡ä»¶
4. æ‰€æœ‰ä¸­é—´æ–‡ä»¶éƒ½ä¼šè¢«é€‰ä¸­

### æ­¥éª¤äºŒï¼šç¡®è®¤æ–‡ä»¶åˆ—è¡¨

ä¸Šä¼ åä¼šæ˜¾ç¤ºæ–‡ä»¶åˆ—è¡¨ï¼š

```
å·²é€‰æ‹© 5 ä¸ªæ–‡ä»¶:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ–‡ä»¶å              æ—¶é•¿      å¤§å°        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ lesson_01.mp4      10:30     125MB       â”‚
â”‚ lesson_02.mp4      15:45     189MB       â”‚
â”‚ lesson_03.mp4      08:20     98MB        â”‚
â”‚ lesson_04.mp4      12:10     145MB       â”‚
â”‚ lesson_05.mp4      09:55     118MB       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ€»è®¡               56:40     675MB       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

é¢„ä¼°å¤„ç†æ—¶é—´: çº¦ 30-40 åˆ†é’Ÿ
```

### æ­¥éª¤ä¸‰ï¼šé€‰æ‹©å¤„ç†æ¨¡å¼

ä¸å•æ–‡ä»¶ç›¸åŒï¼Œé€‰æ‹©ï¼š

- **ä»…ç”Ÿæˆå­—å¹•**ï¼šè¾“å‡º SRT æ–‡ä»¶
- **ç”Ÿæˆå¸¦å­—å¹•çš„è§†é¢‘**ï¼šè¾“å‡º SRT + è§†é¢‘æ–‡ä»¶

**æ³¨æ„**ï¼šæ‰¹é‡ä¸­æ‰€æœ‰æ–‡ä»¶ä½¿ç”¨ç›¸åŒçš„å¤„ç†æ¨¡å¼

### æ­¥éª¤å››ï¼šå¼€å§‹æ‰¹é‡å¤„ç†

ç‚¹å‡»"å¼€å§‹æ‰¹é‡å¤„ç†"æŒ‰é’®ï¼š

```
æ‰¹æ¬¡ ID: batch_20251023_105500
æ€»ä»»åŠ¡æ•°: 5
çŠ¶æ€: å¤„ç†ä¸­ (1/5)

å½“å‰å¤„ç†: lesson_01.mp4
è¿›åº¦: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 50%
ç¿»è¯‘åŸæ–‡å­—å¹• (45/90)

é˜Ÿåˆ—ä¸­:
  â³ lesson_02.mp4
  â³ lesson_03.mp4
  â³ lesson_04.mp4
  â³ lesson_05.mp4
```

### æ­¥éª¤äº”ï¼šç›‘æ§æ‰¹é‡è¿›åº¦

#### æ•´ä½“è¿›åº¦

```
æ‰¹æ¬¡è¿›åº¦: 2/5 å·²å®Œæˆ (40%)
æ€»è€—æ—¶: 15 åˆ†é’Ÿ
é¢„è®¡å‰©ä½™: 22 åˆ†é’Ÿ
```

#### å„ä»»åŠ¡çŠ¶æ€

```
âœ… lesson_01.mp4  å·²å®Œæˆ  100%
âœ… lesson_02.mp4  å·²å®Œæˆ  100%
ğŸ”„ lesson_03.mp4  å¤„ç†ä¸­   65%
â³ lesson_04.mp4  é˜Ÿåˆ—ä¸­    0%
â³ lesson_05.mp4  é˜Ÿåˆ—ä¸­    0%
```

### æ­¥éª¤å…­ï¼šä¸‹è½½æ‰¹é‡ç»“æœ

æ‰€æœ‰ä»»åŠ¡å®Œæˆåï¼š

```
âœ… æ‰¹æ¬¡å¤„ç†å®Œæˆï¼

å·²å®Œæˆ: 5/5
å¤±è´¥: 0/5

ä¸‹è½½é€‰é¡¹:
[ä¸‹è½½å…¨éƒ¨ (ZIP)]  [é€ä¸ªä¸‹è½½]
```

#### ä¸‹è½½å…¨éƒ¨ï¼ˆæ¨èï¼‰

ç‚¹å‡»"ä¸‹è½½å…¨éƒ¨"è·å¾— ZIP å‹ç¼©åŒ…ï¼š

```
batch_20251023_105500.zip
â”œâ”€â”€ lesson_01_raw.srt
â”œâ”€â”€ lesson_01_translated.srt
â”œâ”€â”€ lesson_01_bilingual.srt
â”œâ”€â”€ lesson_01_final.mp4         # å¦‚æœæ˜¯è§†é¢‘æ¨¡å¼
â”œâ”€â”€ lesson_02_raw.srt
â”œâ”€â”€ lesson_02_translated.srt
â”œâ”€â”€ lesson_02_bilingual.srt
â”œâ”€â”€ lesson_02_final.mp4
â”œâ”€â”€ ...
â””â”€â”€ batch_summary.txt           # æ‰¹æ¬¡æ‘˜è¦
```

#### é€ä¸ªä¸‹è½½

å±•å¼€æ–‡ä»¶åˆ—è¡¨ï¼Œé€ä¸ªä¸‹è½½æ¯ä¸ªä»»åŠ¡çš„ç»“æœã€‚

---

## API æ‰¹é‡å¤„ç†

### åˆ›å»ºæ‰¹é‡ä»»åŠ¡

**ç«¯ç‚¹**: `POST /api/batch/process/{invite_code}`

**è¯·æ±‚ç¤ºä¾‹**:

```bash
curl -X POST http://localhost:5000/api/batch/process/kindmita \
  -F "files=@lesson_01.mp4" \
  -F "files=@lesson_02.mp4" \
  -F "files=@lesson_03.mp4" \
  -F "files=@lesson_04.mp4" \
  -F "files=@lesson_05.mp4" \
  -F "mode=srt"
```

**å“åº”**:

```json
{
  "success": true,
  "batch_id": "batch_20251023_105500",
  "total_tasks": 5,
  "task_ids": [
    "20251023_105500_001",
    "20251023_105500_002",
    "20251023_105500_003",
    "20251023_105500_004",
    "20251023_105500_005"
  ],
  "mode": "srt",
  "total_duration": 3400.0,
  "estimated_time": "çº¦ 30 åˆ†é’Ÿ"
}
```

### æŸ¥è¯¢æ‰¹é‡çŠ¶æ€

**ç«¯ç‚¹**: `GET /api/batch/{batch_id}`

**è¯·æ±‚ç¤ºä¾‹**:

```bash
curl http://localhost:5000/api/batch/batch_20251023_105500
```

**å“åº”**:

```json
{
  "success": true,
  "batch_id": "batch_20251023_105500",
  "status": "processing",
  "progress": "å¤„ç†ä¸­... (2/5)",
  "total": 5,
  "completed": 2,
  "processing": 1,
  "pending": 2,
  "failed": 0,
  "sub_tasks": {
    "20251023_105500_001": {
      "task_id": "20251023_105500_001",
      "video_name": "lesson_01.mp4",
      "status": "å·²å®Œæˆ",
      "progress": "å®Œæˆ",
      "prog_bar": 100
    },
    "20251023_105500_002": {
      "task_id": "20251023_105500_002",
      "video_name": "lesson_02.mp4",
      "status": "å·²å®Œæˆ",
      "progress": "å®Œæˆ",
      "prog_bar": 100
    },
    "20251023_105500_003": {
      "task_id": "20251023_105500_003",
      "video_name": "lesson_03.mp4",
      "status": "ç¿»è¯‘åŸæ–‡å­—å¹•",
      "progress": "ç¿»è¯‘ä¸­...",
      "prog_bar": 65
    },
    "20251023_105500_004": {
      "task_id": "20251023_105500_004",
      "video_name": "lesson_04.mp4",
      "status": "é˜Ÿåˆ—ä¸­",
      "progress": "ç­‰å¾…å¤„ç†",
      "prog_bar": 0
    },
    "20251023_105500_005": {
      "task_id": "20251023_105500_005",
      "video_name": "lesson_05.mp4",
      "status": "é˜Ÿåˆ—ä¸­",
      "progress": "ç­‰å¾…å¤„ç†",
      "prog_bar": 0
    }
  },
  "created_at": "2025-10-23 10:55:00",
  "updated_at": "2025-10-23 11:15:30"
}
```

### ä¸‹è½½æ‰¹é‡ç»“æœ

**ç«¯ç‚¹**: `GET /api/batch/download/{batch_id}`

**è¯·æ±‚ç¤ºä¾‹**:

```bash
curl -o batch_result.zip \
  http://localhost:5000/api/batch/download/batch_20251023_105500
```

### Python æ‰¹é‡å¤„ç†ç¤ºä¾‹

```python
import requests
import time
import os

class BatchProcessor:
    def __init__(self, base_url, invite_code):
        self.base_url = base_url
        self.invite_code = invite_code

    def create_batch(self, video_files, mode="srt"):
        """åˆ›å»ºæ‰¹é‡ä»»åŠ¡"""
        url = f"{self.base_url}/batch/process/{self.invite_code}"

        files = [('files', open(f, 'rb')) for f in video_files]
        data = {'mode': mode}

        try:
            response = requests.post(url, files=files, data=data)
            return response.json()
        finally:
            # å…³é—­æ–‡ä»¶å¥æŸ„
            for _, file_obj in files:
                file_obj.close()

    def get_batch_status(self, batch_id):
        """è·å–æ‰¹é‡çŠ¶æ€"""
        url = f"{self.base_url}/batch/{batch_id}"
        response = requests.get(url)
        return response.json()

    def download_batch(self, batch_id, output_path):
        """ä¸‹è½½æ‰¹é‡ç»“æœ"""
        url = f"{self.base_url}/batch/download/{batch_id}"
        response = requests.get(url, stream=True)

        total_size = int(response.headers.get('content-length', 0))
        downloaded = 0

        with open(output_path, 'wb') as f:
            for chunk in response.iter_content(chunk_size=8192):
                if chunk:
                    f.write(chunk)
                    downloaded += len(chunk)
                    progress = (downloaded / total_size) * 100
                    print(f"\rä¸‹è½½è¿›åº¦: {progress:.1f}%", end='', flush=True)

        print("\nä¸‹è½½å®Œæˆ!")

    def wait_for_completion(self, batch_id, check_interval=10):
        """ç­‰å¾…æ‰¹é‡ä»»åŠ¡å®Œæˆ"""
        while True:
            status = self.get_batch_status(batch_id)

            print(f"\næ‰¹æ¬¡çŠ¶æ€: {status['status']}")
            print(f"è¿›åº¦: {status['progress']}")
            print(f"å·²å®Œæˆ: {status['completed']}/{status['total']}")
            print(f"å¤„ç†ä¸­: {status['processing']}")
            print(f"é˜Ÿåˆ—ä¸­: {status['pending']}")
            print(f"å¤±è´¥: {status['failed']}")

            # æ˜¾ç¤ºå„ä»»åŠ¡çŠ¶æ€
            print("\nä»»åŠ¡è¯¦æƒ…:")
            for task_id, task in status['sub_tasks'].items():
                icon = "âœ…" if task['status'] == "å·²å®Œæˆ" else \
                       "âŒ" if task['status'] == "å¤±è´¥" else \
                       "ğŸ”„" if task['status'] in ["processing", "æå–åŸæ–‡å­—å¹•", "ç¿»è¯‘åŸæ–‡å­—å¹•"] else \
                       "â³"
                print(f"  {icon} {task['video_name']:<20} {task['status']:<15} {task['prog_bar']:>3}%")

            if status['status'] == 'å·²å®Œæˆ':
                print("\nâœ… æ‰¹æ¬¡å¤„ç†å®Œæˆ!")
                return True
            elif status['status'] == 'å¤±è´¥':
                print("\nâŒ æ‰¹æ¬¡å¤„ç†å¤±è´¥!")
                return False

            time.sleep(check_interval)

# ä½¿ç”¨ç¤ºä¾‹
if __name__ == "__main__":
    processor = BatchProcessor(
        base_url="http://localhost:5000/api",
        invite_code="kindmita"
    )

    # å‡†å¤‡è§†é¢‘æ–‡ä»¶åˆ—è¡¨
    video_files = [
        "lesson_01.mp4",
        "lesson_02.mp4",
        "lesson_03.mp4",
        "lesson_04.mp4",
        "lesson_05.mp4"
    ]

    # åˆ›å»ºæ‰¹é‡ä»»åŠ¡
    print("åˆ›å»ºæ‰¹é‡ä»»åŠ¡...")
    result = processor.create_batch(video_files, mode="srt")
    batch_id = result['batch_id']

    print(f"æ‰¹æ¬¡ID: {batch_id}")
    print(f"ä»»åŠ¡æ•°: {result['total_tasks']}")
    print(f"é¢„è®¡æ—¶é—´: {result['estimated_time']}")

    # ç­‰å¾…å®Œæˆ
    if processor.wait_for_completion(batch_id):
        # ä¸‹è½½ç»“æœ
        output_file = f"{batch_id}.zip"
        print(f"\nå¼€å§‹ä¸‹è½½ç»“æœåˆ° {output_file}...")
        processor.download_batch(batch_id, output_file)
        print(f"âœ… æ‰¹é‡å¤„ç†å®Œæˆï¼Œç»“æœå·²ä¿å­˜åˆ° {output_file}")
```

---

## æ‰¹é‡ä»»åŠ¡ç®¡ç†

### æ‰¹æ¬¡çŠ¶æ€è¯´æ˜

| çŠ¶æ€ | è¯´æ˜ |
|------|------|
| é˜Ÿåˆ—ä¸­ | æ•´ä¸ªæ‰¹æ¬¡åœ¨é˜Ÿåˆ—ä¸­ç­‰å¾… |
| processing | æ‰¹æ¬¡æ­£åœ¨å¤„ç†ä¸­ |
| å·²å®Œæˆ | æ‰€æœ‰ä»»åŠ¡éƒ½æˆåŠŸå®Œæˆ |
| éƒ¨åˆ†å®Œæˆ | éƒ¨åˆ†ä»»åŠ¡å®Œæˆï¼Œéƒ¨åˆ†å¤±è´¥ |
| å¤±è´¥ | æ‰€æœ‰ä»»åŠ¡éƒ½å¤±è´¥ |

### å­ä»»åŠ¡çŠ¶æ€

æ¯ä¸ªå­ä»»åŠ¡éƒ½æœ‰ç‹¬ç«‹çš„çŠ¶æ€ï¼š

- **é˜Ÿåˆ—ä¸­**ï¼šç­‰å¾…å¤„ç†
- **processing**ï¼šæ­£åœ¨å¤„ç†
- **æå–åŸæ–‡å­—å¹•**ï¼šè¯­éŸ³è¯†åˆ«ä¸­
- **ç¿»è¯‘åŸæ–‡å­—å¹•**ï¼šç¿»è¯‘ä¸­
- **å·²å®Œæˆ**ï¼šæˆåŠŸå®Œæˆ
- **å¤±è´¥**ï¼šå¤„ç†å¤±è´¥

### æ‰¹æ¬¡æ•°æ®ç»“æ„

```json
{
  "batch_id": "batch_20251023_105500",
  "status": "processing",
  "total": 5,
  "completed": 2,
  "processing": 1,
  "pending": 2,
  "failed": 0,
  "sub_tasks": {
    "task_id_1": {...},
    "task_id_2": {...},
    ...
  },
  "created_at": "2025-10-23 10:55:00",
  "updated_at": "2025-10-23 11:15:30"
}
```

### æŸ¥è¯¢å•ä¸ªå­ä»»åŠ¡

ä¹Ÿå¯ä»¥å•ç‹¬æŸ¥è¯¢æ‰¹æ¬¡ä¸­çš„æŸä¸ªå­ä»»åŠ¡ï¼š

```bash
curl http://localhost:5000/api/task/20251023_105500_003
```

---

## æœ€ä½³å®è·µ

### 1. æ–‡ä»¶å‘½åè§„èŒƒ

ä½¿ç”¨æ¸…æ™°çš„å‘½åè§„åˆ™ï¼Œä¾¿äºåæœŸç®¡ç†ï¼š

```
# å¥½çš„å‘½å
lesson_01_introduction.mp4
lesson_02_basic_concepts.mp4
lesson_03_advanced_topics.mp4

# ä¸å¥½çš„å‘½å
video1.mp4
new_video.mp4
final_final_v2.mp4
```

### 2. æ–‡ä»¶ç»„ç»‡

æŒ‰æ‰¹æ¬¡ç»„ç»‡æ–‡ä»¶ï¼š

```
videos/
â”œâ”€â”€ batch_1_basic/
â”‚   â”œâ”€â”€ lesson_01.mp4
â”‚   â”œâ”€â”€ lesson_02.mp4
â”‚   â””â”€â”€ lesson_03.mp4
â”œâ”€â”€ batch_2_advanced/
â”‚   â”œâ”€â”€ lesson_04.mp4
â”‚   â”œâ”€â”€ lesson_05.mp4
â”‚   â””â”€â”€ lesson_06.mp4
â””â”€â”€ batch_3_projects/
    â”œâ”€â”€ project_01.mp4
    â””â”€â”€ project_02.mp4
```

### 3. æ‰¹æ¬¡å¤§å°æ§åˆ¶

#### æ¨èæ‰¹æ¬¡å¤§å°

| åœºæ™¯ | æ¨èæ–‡ä»¶æ•° | åŸå›  |
|------|-----------|------|
| å¿«é€Ÿå¤„ç† | 2-3 ä¸ª | å¯å¿«é€Ÿå®Œæˆ |
| ç³»åˆ—è§†é¢‘ | 5-8 ä¸ª | å¹³è¡¡æ•ˆç‡å’Œç®¡ç† |
| å¤§æ‰¹é‡ | åˆ†å¤šä¸ªæ‰¹æ¬¡ | é¿å…å•æ‰¹æ¬¡è¿‡å¤§ |

#### ç¤ºä¾‹ï¼šå¤„ç† 30 ä¸ªè§†é¢‘

```python
# åˆ†æˆ 3 ä¸ªæ‰¹æ¬¡
batches = [
    videos[0:10],   # æ‰¹æ¬¡ 1
    videos[10:20],  # æ‰¹æ¬¡ 2
    videos[20:30]   # æ‰¹æ¬¡ 3
]

for i, batch in enumerate(batches, 1):
    print(f"å¤„ç†æ‰¹æ¬¡ {i}...")
    result = processor.create_batch(batch)
    processor.wait_for_completion(result['batch_id'])
```

### 4. é…é¢ç®¡ç†

åœ¨æ‰¹é‡å¤„ç†å‰æ£€æŸ¥é…é¢ï¼š

```python
def check_quota_before_batch(processor, video_files, invite_code):
    """æ£€æŸ¥é…é¢æ˜¯å¦å……è¶³"""
    # è®¡ç®—æ€»æ—¶é•¿
    total_duration = sum(get_video_duration(f) for f in video_files)

    # æ£€æŸ¥é…é¢
    url = f"{processor.base_url}/invitation/check/{invite_code}"
    response = requests.get(url)
    quota = response.json()

    if quota['quota']['remaining'] < total_duration:
        print(f"âš ï¸ é…é¢ä¸è¶³ï¼")
        print(f"éœ€è¦: {total_duration} ç§’")
        print(f"å‰©ä½™: {quota['quota']['remaining']} ç§’")
        return False

    print(f"âœ… é…é¢å……è¶³")
    print(f"éœ€è¦: {total_duration} ç§’")
    print(f"å‰©ä½™: {quota['quota']['remaining']} ç§’")
    return True
```

### 5. é”™è¯¯å¤„ç†

å¤„ç†éƒ¨åˆ†å¤±è´¥çš„æ‰¹æ¬¡ï¼š

```python
def handle_failed_tasks(processor, batch_id):
    """å¤„ç†å¤±è´¥çš„ä»»åŠ¡"""
    status = processor.get_batch_status(batch_id)

    failed_tasks = []
    for task_id, task in status['sub_tasks'].items():
        if task['status'] == 'å¤±è´¥':
            failed_tasks.append({
                'task_id': task_id,
                'video_name': task['video_name'],
                'error': task.get('error', 'æœªçŸ¥é”™è¯¯')
            })

    if failed_tasks:
        print(f"\nâŒ å‘ç° {len(failed_tasks)} ä¸ªå¤±è´¥ä»»åŠ¡:")
        for task in failed_tasks:
            print(f"  - {task['video_name']}: {task['error']}")

        # é‡æ–°å¤„ç†å¤±è´¥çš„è§†é¢‘
        retry_files = [task['video_name'] for task in failed_tasks]
        print(f"\né‡æ–°å¤„ç†å¤±è´¥çš„ä»»åŠ¡...")
        result = processor.create_batch(retry_files)
        return result['batch_id']

    return None
```

### 6. è¿›åº¦é€šçŸ¥

æ·»åŠ è¿›åº¦é€šçŸ¥åŠŸèƒ½ï¼š

```python
def notify_on_complete(batch_id, email=None):
    """æ‰¹æ¬¡å®Œæˆæ—¶å‘é€é€šçŸ¥"""
    import smtplib
    from email.mime.text import MIMEText

    if email:
        msg = MIMEText(f"æ‰¹æ¬¡ {batch_id} å¤„ç†å®Œæˆï¼")
        msg['Subject'] = 'Tranvideo æ‰¹é‡ä»»åŠ¡å®Œæˆ'
        msg['From'] = 'noreply@tranvideo.com'
        msg['To'] = email

        # å‘é€é‚®ä»¶ï¼ˆéœ€è¦é…ç½® SMTPï¼‰
        # smtp = smtplib.SMTP('localhost')
        # smtp.send_message(msg)
        # smtp.quit()

        print(f"âœ… é€šçŸ¥å·²å‘é€åˆ° {email}")
```

---

## æ‰¹é‡ä¸‹è½½ç»“æœ

### ZIP åŒ…ç»“æ„

```
batch_20251023_105500.zip
â”œâ”€â”€ batch_summary.txt          # æ‰¹æ¬¡æ‘˜è¦
â”œâ”€â”€ lesson_01/
â”‚   â”œâ”€â”€ raw.srt
â”‚   â”œâ”€â”€ translated.srt
â”‚   â”œâ”€â”€ bilingual.srt
â”‚   â””â”€â”€ final.mp4             # ä»…è§†é¢‘æ¨¡å¼
â”œâ”€â”€ lesson_02/
â”‚   â”œâ”€â”€ raw.srt
â”‚   â”œâ”€â”€ translated.srt
â”‚   â”œâ”€â”€ bilingual.srt
â”‚   â””â”€â”€ final.mp4
â””â”€â”€ ...
```

### æ‰¹æ¬¡æ‘˜è¦ç¤ºä¾‹

```txt
=====================================
Tranvideo æ‰¹é‡å¤„ç†æ‘˜è¦
=====================================

æ‰¹æ¬¡ ID: batch_20251023_105500
åˆ›å»ºæ—¶é—´: 2025-10-23 10:55:00
å®Œæˆæ—¶é—´: 2025-10-23 11:45:30
å¤„ç†æ¨¡å¼: srt

ä»»åŠ¡ç»Ÿè®¡:
- æ€»ä»»åŠ¡æ•°: 5
- å·²å®Œæˆ: 5
- å¤±è´¥: 0
- æ€»è€—æ—¶: 50 åˆ†é’Ÿ

ä»»åŠ¡è¯¦æƒ…:
1. lesson_01.mp4 - å·²å®Œæˆ (10:30)
2. lesson_02.mp4 - å·²å®Œæˆ (15:45)
3. lesson_03.mp4 - å·²å®Œæˆ (08:20)
4. lesson_04.mp4 - å·²å®Œæˆ (12:10)
5. lesson_05.mp4 - å·²å®Œæˆ (09:55)

æ€»è§†é¢‘æ—¶é•¿: 56:40
=====================================
```

### è§£å‹å’Œä½¿ç”¨

```bash
# è§£å‹ ZIP åŒ…
unzip batch_20251023_105500.zip -d results/

# æŸ¥çœ‹ç›®å½•ç»“æ„
tree results/

# ä½¿ç”¨å­—å¹•æ–‡ä»¶
vlc video.mp4 --sub-file=results/lesson_01/translated.srt
```

---

## æ•…éšœæ’é™¤

### æ‰¹é‡ä¸Šä¼ å¤±è´¥

**é—®é¢˜**: æ— æ³•ä¸Šä¼ å¤šä¸ªæ–‡ä»¶

**è§£å†³æ–¹æ³•**:

1. æ£€æŸ¥æ–‡ä»¶æ•°é‡æ˜¯å¦è¶…è¿‡ 10 ä¸ª
2. æ£€æŸ¥å•æ–‡ä»¶å¤§å°æ˜¯å¦è¶…è¿‡ 2GB
3. æ£€æŸ¥æ€»å¤§å°æ˜¯å¦è¿‡å¤§ï¼ˆå»ºè®® < 10GBï¼‰
4. å°è¯•åˆ†æ‰¹ä¸Šä¼ 

### éƒ¨åˆ†ä»»åŠ¡å¤±è´¥

**é—®é¢˜**: æ‰¹æ¬¡ä¸­éƒ¨åˆ†ä»»åŠ¡å¤±è´¥

**è§£å†³æ–¹æ³•**:

1. æŸ¥çœ‹å¤±è´¥ä»»åŠ¡çš„é”™è¯¯ä¿¡æ¯
2. å•ç‹¬é‡æ–°å¤„ç†å¤±è´¥çš„è§†é¢‘
3. æ£€æŸ¥å¤±è´¥è§†é¢‘çš„æ–‡ä»¶æ˜¯å¦æŸå

```python
# é‡æ–°å¤„ç†å¤±è´¥çš„ä»»åŠ¡
failed_videos = ['lesson_03.mp4', 'lesson_05.mp4']
result = processor.create_batch(failed_videos)
```

### ä¸‹è½½ ZIP å¤±è´¥

**é—®é¢˜**: æ— æ³•ä¸‹è½½æ‰¹é‡ç»“æœ

**è§£å†³æ–¹æ³•**:

1. æ£€æŸ¥æ‰€æœ‰ä»»åŠ¡æ˜¯å¦éƒ½å·²å®Œæˆ
2. å°è¯•é€ä¸ªä¸‹è½½ä»»åŠ¡ç»“æœ
3. æ£€æŸ¥ç£ç›˜ç©ºé—´æ˜¯å¦å……è¶³
4. é‡æ–°è¯·æ±‚ä¸‹è½½é“¾æ¥

### æ‰¹æ¬¡çŠ¶æ€ä¸æ›´æ–°

**é—®é¢˜**: æ‰¹æ¬¡çŠ¶æ€åœæ»ä¸å‰

**è§£å†³æ–¹æ³•**:

1. åˆ·æ–°é¡µé¢æˆ–é‡æ–°æŸ¥è¯¢
2. æ£€æŸ¥æœåŠ¡å™¨æ—¥å¿—
3. æ£€æŸ¥æ˜¯å¦æœ‰ä»»åŠ¡å¡ä½
4. è”ç³»ç®¡ç†å‘˜

---

## é«˜çº§ç”¨æ³•

### è‡ªåŠ¨åŒ–æ‰¹é‡å¤„ç†

```python
#!/usr/bin/env python3
"""
è‡ªåŠ¨åŒ–æ‰¹é‡å¤„ç†è„šæœ¬
ç›‘æ§ç›®å½•ï¼Œè‡ªåŠ¨æ‰¹é‡å¤„ç†æ–°è§†é¢‘
"""

import os
import time
from watchdog.observers import Observer
from watchdog.events import FileSystemEventHandler

class BatchHandler(FileSystemEventHandler):
    def __init__(self, processor, batch_size=5):
        self.processor = processor
        self.batch_size = batch_size
        self.pending_files = []

    def on_created(self, event):
        if event.src_path.endswith('.mp4'):
            self.pending_files.append(event.src_path)
            print(f"æ£€æµ‹åˆ°æ–°æ–‡ä»¶: {event.src_path}")

            if len(self.pending_files) >= self.batch_size:
                self.process_batch()

    def process_batch(self):
        if not self.pending_files:
            return

        print(f"\nå¼€å§‹å¤„ç† {len(self.pending_files)} ä¸ªæ–‡ä»¶...")
        result = self.processor.create_batch(self.pending_files)
        batch_id = result['batch_id']

        self.pending_files = []

        # ç­‰å¾…å®Œæˆå¹¶ä¸‹è½½
        if self.processor.wait_for_completion(batch_id):
            self.processor.download_batch(batch_id, f"{batch_id}.zip")

# è¿è¡Œç›‘æ§
processor = BatchProcessor("http://localhost:5000/api", "kindmita")
handler = BatchHandler(processor, batch_size=5)

observer = Observer()
observer.schedule(handler, path='./videos', recursive=False)
observer.start()

print("å¼€å§‹ç›‘æ§ ./videos ç›®å½•...")

try:
    while True:
        time.sleep(1)
except KeyboardInterrupt:
    observer.stop()

observer.join()
```

---

## ç›¸å…³æ–‡æ¡£

- ğŸ“– [åŸºç¡€ä½¿ç”¨](Basic-Usage.md) - å•æ–‡ä»¶å¤„ç†æŒ‡å—
- ğŸ”§ [API æ–‡æ¡£](API-Reference.md) - æ‰¹é‡ API è¯¦ç»†æ–‡æ¡£
- âš™ï¸ [é…ç½®æŒ‡å—](Configuration.md) - ç³»ç»Ÿé…ç½®
- ğŸ’¡ [æ•…éšœæ’é™¤](Troubleshooting.md) - é—®é¢˜è§£å†³

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**æœ€åæ›´æ–°**: 2025-10-24
**ç»´æŠ¤è€…**: MitaHill

[è¿”å› Wiki é¦–é¡µ](Home.md)
