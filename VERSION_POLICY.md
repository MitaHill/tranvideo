# 版本管理策略 (Version Policy)

本文档定义 Tranvideo 项目的版本管理策略和发布流程。

## 版本号规范

Tranvideo 采用 [语义化版本 2.0.0](https://semver.org/lang/zh-CN/) (Semantic Versioning) 标准。

### 版本号格式

```
主版本号.次版本号.修订号 (MAJOR.MINOR.PATCH)
```

例如: `1.2.3`

- **主版本号 (MAJOR)**: 当你做了不兼容的 API 修改
- **次版本号 (MINOR)**: 当你做了向下兼容的功能性新增
- **修订号 (PATCH)**: 当你做了向下兼容的问题修正

### 先行版本标识

在正式版本之前,可以添加先行版本标识:

- `alpha` - 内部测试版: `0.6.0-alpha.1`
- `beta` - 公开测试版: `0.6.0-beta.1`
- `rc` - 候选发布版: `0.6.0-rc.1`

示例:
```
1.0.0-alpha.1  < 1.0.0-beta.1  < 1.0.0-rc.1  < 1.0.0
```

## 版本发布周期

### 1. 开发版本 (0.x.x)

- **当前阶段**: v0.6.0
- **特点**: 功能快速迭代，API可能变动
- **发布频率**: 根据功能完成度不定期发布
- **稳定性**: 基本稳定，适合测试和体验

### 2. 稳定版本 (1.x.x)

- **目标版本**: v1.0.0
- **特点**: API稳定，向下兼容
- **发布频率**:
  - 主版本: 6-12个月
  - 次版本: 1-3个月
  - 修订版: 按需发布(修复严重问题)

### 3. 长期支持版本 (LTS)

- **计划**: v2.0.0 开始考虑LTS版本
- **支持周期**: 24个月
- **维护内容**: 安全修复和重要bug修复

## 版本递增规则

### 主版本号递增 (x.0.0)

**时机**:
- 破坏性API变更
- 重大架构调整
- 移除已弃用的功能
- 不兼容的依赖升级

**示例**:
```
0.6.0 → 1.0.0  (正式版发布)
1.9.5 → 2.0.0  (引入新架构，不兼容旧版API)
```

### 次版本号递增 (x.y.0)

**时机**:
- 新增向下兼容的功能
- 新增API接口
- 标记功能为弃用(但未移除)
- 重要的内部功能改进

**示例**:
```
0.6.0 → 0.7.0  (新增视频剪辑功能)
1.2.5 → 1.3.0  (新增批量导出API)
```

### 修订号递增 (x.y.z)

**时机**:
- Bug修复
- 性能优化(不改变API)
- 文档更新
- 依赖包安全更新

**示例**:
```
0.6.0 → 0.6.1  (修复显存泄漏问题)
1.2.3 → 1.2.4  (优化字幕渲染性能)
```

## Docker 镜像版本策略

### 镜像标签规范

```bash
kindmitaishere/tranvideo:<tag>
```

**标签类型**:

1. **语义化版本标签**
   ```
   kindmitaishere/tranvideo:0.6.0
   kindmitaishere/tranvideo:1.0.0
   kindmitaishere/tranvideo:1.2.3
   ```

2. **简化版本标签**
   ```
   kindmitaishere/tranvideo:0.6    (指向 0.6.x 最新版)
   kindmitaishere/tranvideo:1      (指向 1.x.x 最新版)
   kindmitaishere/tranvideo:1.2    (指向 1.2.x 最新版)
   ```

3. **特殊标签**
   ```
   kindmitaishere/tranvideo:latest       (最新稳定版)
   kindmitaishere/tranvideo:dev          (开发版本)
   kindmitaishere/tranvideo:nightly      (每日构建)
   ```

### 当前标签映射

```
当前版本: v0.6.0

标签列表:
- latest      → 0.6.0
- 0.6         → 0.6.0
- 0.6.0       → 0.6.0
- dev         → 开发分支最新构建
```

### 弃用旧标签格式

**不推荐**: `tranvideo-v0.6` (当前使用)
**推荐**: `tranvideo:0.6.0`

从 v1.0.0 开始将统一使用标准格式。

## 分支管理策略

```
main (master)           - 稳定版本分支,仅包含已发布的代码
  ├─ develop           - 开发分支,下一版本的开发工作
  ├─ release/1.0.0     - 发布准备分支
  ├─ hotfix/1.0.1      - 紧急修复分支
  └─ feature/xxx       - 功能开发分支
```

### 分支说明

- **main**: 生产环境代码,每次合并都应该打tag
- **develop**: 日常开发分支
- **release/x.y.z**: 发布准备分支,用于发布前的测试和修复
- **hotfix/x.y.z**: 紧急修复分支,修复生产环境的严重问题
- **feature/xxx**: 功能开发分支

## Git 标签规范

### 标签命名

```bash
v0.6.0
v1.0.0
v1.2.3
v2.0.0-alpha.1
v2.0.0-beta.1
v2.0.0-rc.1
```

### 创建标签

```bash
# 创建带注释的标签
git tag -a v0.6.0 -m "Release version 0.6.0"

# 推送标签到远程
git push origin v0.6.0

# 推送所有标签
git push origin --tags
```

### 标签与发布的关系

- 每个Git标签对应一个GitHub Release
- 每个Release包含:
  - 版本号和发布日期
  - 变更日志(从CHANGELOG.md提取)
  - Docker镜像链接
  - 源码压缩包

## 版本发布检查清单

在发布新版本前,请确认以下事项:

### 代码层面
- [ ] 所有测试通过
- [ ] 代码审查完成
- [ ] 文档已更新
- [ ] CHANGELOG.md 已更新
- [ ] 没有已知的严重bug

### 构建层面
- [ ] Docker镜像构建成功
- [ ] 镜像已推送到Docker Hub
- [ ] 多架构支持(amd64/arm64)已测试

### 文档层面
- [ ] README.md 版本信息已更新
- [ ] API文档已更新
- [ ] Wiki文档已更新
- [ ] 发布说明已编写

### 发布层面
- [ ] Git标签已创建并推送
- [ ] GitHub Release已创建
- [ ] Docker镜像标签已更新
- [ ] 社区公告已发布

## 版本支持策略

| 版本类型 | 支持周期 | 更新内容 |
|---------|---------|---------|
| 开发版 (0.x.x) | 下一版本发布前 | 功能更新、Bug修复 |
| 稳定版 (1.x.x) | 下一主版本发布后6个月 | 安全修复、严重Bug修复 |
| LTS版本 (计划中) | 24个月 | 安全修复、严重Bug修复 |

## 废弃功能处理

1. **标记为废弃** - 在次版本中标记,文档中说明
2. **保持兼容** - 至少保留一个主版本周期
3. **提供迁移指南** - 文档说明如何迁移到新API
4. **最终移除** - 在下一个主版本中移除

## 紧急修复流程

对于严重的安全问题或数据丢失问题:

1. 从 `main` 分支创建 `hotfix/x.y.z` 分支
2. 修复问题并完成测试
3. 更新 CHANGELOG.md
4. 合并到 `main` 和 `develop`
5. 创建新的修订版本标签
6. 立即发布

## 未来规划

### v0.7.0 - v0.9.x (2025 Q2-Q3)
- 功能完善和优化
- 性能基准测试
- 文档完善

### v1.0.0 (2025 Q4)
- 正式版发布
- API稳定承诺
- 生产环境就绪

### v2.0.0 (2026)
- 架构升级
- 新特性引入
- LTS支持计划

---

**最后更新**: 2025-10-23
**当前版本**: v0.6.0
**下一计划版本**: v1.0.0
